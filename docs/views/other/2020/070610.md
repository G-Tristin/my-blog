---
title: 移动端适配问题
date: 2020-07-06
tags:
 - 移动端
 - 像素比
categories: 
 - other
---

本篇文章的目的在于明白什么是移动端适配问题，以及如何解决移动端的适配问题。

<!-- more -->

### 什么是移动端适配问题？
在移动端开发过程中，我们通过px给移动端页面设置宽高时，在不同的设备当中会出现各种各样的显示问题。那么该如何解决这个问题？首先我们先了解一些前置知识，什么是像素？移动端的像素和桌面的像素有什么区别，缩放对像素有什么影响？视网膜屏幕和像素又有什么关系？

### 像素
像素又可以被称为画素，是显示图像的基本单位。一个像素就是计算机能够显示一种特定颜色的最小区域。当设备尺寸相同单像素变得密集时，屏幕能显示的画面过渡变得更加细致，网站看起来更加清晰明朗。

#### 像素分类
在前端开发中我们需要了解的像素分类大致可以分为以下3种：
- 设备像素(device independent pixels)：设备屏幕的物理像素，任何设备的物理像素都是固定的
- css像素(CSS pixels)：又称为逻辑像素，是为web开发者创造的，在CSS和javaScript中使用的抽象层
- 设备独立像素：独立于设备的用于逻辑上衡量长度的单位，由底层系统的程序使用，会由相关系统转换为物理像素。所以它只是一个虚拟像素单位。

::: tip
每一个CSS声明和几乎所有的javaScript属性用的都是CSS像素，因此实际上基本不使用设备像素，唯一例外的是scree.width/height。设备独立像素是一个整体的概念。比如:css像素，只是在android 机中，css像素不叫 “css像素”了，而叫“设备独立像素”。
:::

### 缩放对像素的影响
设备像素大小是固定的，而设备独立像素是可以被拉长或压缩的。在桌面端，在不缩放的情况下，1个css像素往往对应着电脑屏幕的一个物理像素。但是在手机端，由于dpr的关系一个设备独立像素(css像素)对应的物理像素是不同的，并且由于屏幕尺寸的限制用户经常会进行一些缩放操作。导致当用户对页面进行缩小时，一个设备像素会覆盖多个css像素。当用户放大时，一个CSS像素会覆盖多个物理像素。

::: tip
　不论我们进行缩小或放大操作，元素设置的CSS像素(如width:300px)是始终不变的，而一个CSS像素对应多少个设备像素是根据当前的缩放比例以及dpr来决定的。
:::

### HTML中的CSS像素
在html中我们经常会使用viewport(代表的是浏览器中网站可见内容的部分)，经常会设置viewport的width=device-width，即把可视视口设置为设备宽度。这样就可以把页面视口宽度占满整个设备屏幕。
``` html
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
```
>在web中，浏览器为我们提供了`window.devicePixelRatio`获取dpr。在CSS中，可以使用媒体查询`min-device-pixel-radio`来区分dpr。

::: tip
屏幕大小相同的手机，分辨率不一定相同。
:::

### dpr设备像素比

设备像素比(DPR)：是设备物理像素和设备独立像素的比例

我们看一下设备物理像素和设备独立像素的关系。

举个例子，iPhone 3GS 和 iPhone 4/4s 的尺寸都是 3.5 寸，但 iPhone 3GS 的分辨率是 320x480，iPhone 4/4s 的分辨率是 640x960，这也就是意味着同样长度的屏幕，iPhone 3GS 有 320 个物理像素，iPhone 4/4s 有 640 个物理像素。(从iphone4开始，苹果公司推出了所谓的retina视网膜屏幕。之所以叫做视网膜屏幕，是因为屏幕的PPI(屏幕像素密度)太高，人的肉眼无法分辨出屏幕上的像素点。)

> ppi表示屏幕上每个英寸显示的像素点的数量，即屏幕像素密度。什么是Retina视网膜屏幕？PPI 值超过 300 的叫做超高密度屏幕，只是 Apple 给它换了个高大尚的名称：Retina 视网膜屏幕而已。

如果我们按照真实的物理像素进行布局，比如说我们按照 320 物理像素进行布局，到了 640 物理像素的手机上就会有一半的空白，为了避免这种问题，就产生了虚拟像素单位。我们统一 iPhone 3GS 和 iPhone 4/4s 都是 320 个虚拟像素，只是在 iPhone 3GS 上，最终 1 个虚拟像素换算成 1 个物理像素，在 iphone 4s 中，1 个虚拟像素最终换算成 2 个物理像素。至于 1 个虚拟像素被换算成几个物理像素，这个数值我们称之为设备像素比。

通过使用虚拟像素解决了相同尺寸下不同设备由于不同像素导致的图像显示问题，但是当设备尺寸不同时又会产生新的问题。比如，iphone6的屏幕是4.7英寸像素分辨率为750x1334px，iphone5的屏幕是4英寸像素分辨率为640x1136px，它们的dpr都是2.0。但是当我们在web开发时，将css像素(逻辑像素)都设置为320px，那么在iphone5下实际的物理像素为640px整好铺满整个屏幕，但是在iphon6下则会出现一部分的残缺。**这就是我们常说的移动端的适配问题**，那么该如何解决呢?

### 移动端适配问题解决方案

通过上述分析，我们可以了解到对移动设备的适配问题主要是由于dpr导致的。各个手机的dpr的值都是不相同的，有的手机dpr是2有的手机dpr是3。这就导致我们设置页面的CSS像素必须要随着设备的dpr的值进行相应的变动。但是设计师给我们的设计稿基本都是固定尺寸的，那么我们该如何实现适配不同机型的手机呢？

1. 使用js获取innerWidth或者clientWidth设置html的font-size
前置知识：rem是网页根元素的字体大小值。rem是CSS3新增的一个相对单位。这个单位与em有什么区别呢？区别在于使用rem为元素设定大小时，仍然是相对大小，但相对的只是HTML根元素。

原理：当我们通过html的meta标签设置页面宽度为设备宽度之后`width=device-width`，我们通过js的API获取到设备的宽度，相当于我们获取到了设备的物理像素。然后我们设置页面根元素的值为设备宽度按比例缩小的值，之后所有样式的大小都是用rem为单位。这样在不同屏幕大小的页面中都可以按比例放大缩小，达到适配屏幕大小的效果。

实现：
```js
document.documentElement.style.fontSize = document.documentElement.clientWidth / 7.5 + 'px';
//或者
document.documentElement.style.fontSize = window.innerWidth/7.5 + 'px';
//通过以上设置 就相当于把整个屏幕的宽度设置为 7.5rem ，
//而根据设计图是750px的，就可以相当于100px = 1rem ，在布局的时候就可以用rem为单位布局,(设计图是其他大小就改为多少)
//可以添加代码
document.body.style.fontSize = '14px'; // 在body上将字体还原大小，避免页面无样式字体超大
```
2. 以vw、wh作为基础单位
vw和vh是视口（viewport units）单位，就是根据你浏览器窗口的大小的单位，不受显示器分辨率的影响，这就表示我们不需要顾虑到现在那么多不同电脑有关分辨率的自适应问题。
vw是可视窗口的宽度单位，和百分比有点一样，1vw = 可视窗口的宽度的百分之一。比如窗口宽度大小是1800px，那么1vw = 18px。和百分比不一样的是，vw始终相对于可视窗口的宽度，而百分比和其父元素的宽度有关。vh就是可视窗口的高度了。

> 虽然使用vw、vh可以实现元素宽高的响应式布局，但是元素字体大小还是需要使用rem来适配。